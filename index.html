<!doctype html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Semakan Kedudukan Kelas</title>

<style>
:root{
  --primary:#ffc4d6;
  --secondary:#ffe4d4;
  --bg1:#fff7cc;
  --bg2:#fff1b8;
  --text:#2d2d2d;
  --card:#ffffff;
  --border:#eee;
  --danger:#b30000;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:"Segoe UI",Tahoma,Verdana,sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:24px;
}

.container{width:100%;max-width:520px}

.screen{display:none}
.screen.active{display:block}

.header{text-align:center;margin-bottom:20px}

.logo{
  width:110px;height:110px;margin:0 auto 12px;
  background:#fff;border-radius:20px;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 10px 25px rgba(0,0,0,.08)
}
.logo img{width:90px}

h1{margin:8px 0;font-size:1.6rem}
.subtitle{color:#666;font-size:.95rem}

.btn{
  width:100%;padding:16px;border:none;border-radius:999px;
  font-weight:800;text-transform:uppercase;cursor:pointer;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  margin-bottom:12px;
}
.btn.secondary{background:#eee}

.card{
  background:#fff;padding:20px;border-radius:22px;
  box-shadow:0 10px 30px rgba(0,0,0,.08)
}

input{
  width:100%;padding:14px;border-radius:999px;
  border:2px solid var(--primary);font-size:1rem
}

.row{display:flex;gap:12px;margin-top:14px}
.row .btn{flex:1}

.result-card{
  background:#fff;border-radius:22px;padding:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.08)
}

.field{padding:12px 0;border-bottom:1px solid var(--border)}
.field:last-child{border-bottom:none}
.label{font-size:.75rem;font-weight:900;color:#888;text-transform:uppercase}
.value{font-size:1.05rem;font-weight:800}

.error{
  background:#ffe5e5;color:var(--danger);
  padding:18px;border-radius:18px;
  text-align:center;font-weight:800
}
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<section id="home" class="screen active">
  <div class="header">
    <div class="logo"><img src="logopaloh.png"></div>
    <h1>Sistem Semakan Kedudukan Kelas</h1>
    <p class="subtitle">Pilih Tingkatan → Masuk No IC → Papar Keputusan</p>
  </div>

  <button class="btn" onclick="startSemak(2)">Tingkatan 2</button>
  <button class="btn" onclick="startSemak(3)">Tingkatan 3</button>
  <button class="btn secondary" onclick="openBuku()">Senarai Pembelian Buku</button>
</section>

<!-- INPUT -->
<section id="input" class="screen">
  <div class="header">
    <h1 id="badgeTing">Tingkatan</h1>
  </div>

  <div class="card">
    <input id="ic" placeholder="No IC 12 digit">
    <div class="row">
      <button class="btn" onclick="submitCheck()">Semak</button>
      <button class="btn secondary" onclick="goHome()">Kembali</button>
    </div>
  </div>
</section>

<!-- LOADING -->
<section id="loading" class="screen">
  <div class="header"><h1>Menyemak maklumat...</h1></div>
</section>

<!-- RESULT -->
<section id="result" class="screen">
  <div class="header"><h1>Keputusan</h1></div>
  <div id="resultBox" class="result-card"></div>
  <button class="btn secondary" onclick="goHome()">Kembali (Main Page)</button>
</section>

<!-- ERROR -->
<section id="error" class="screen">
  <div class="error" id="errorMsg"></div>
  <button class="btn secondary" onclick="goHome()">Kembali (Main Page)</button>
</section>

</div>

<script>
/* ================= CONFIG ================= */
const API_URL =
"https://script.google.com/macros/s/AKfycbw-Ptinh6OwlWtPhU7_BACIZi1AXKJ6ibOsVj_tHA80zHWMFH0b1CygYfhhABt2cbT4vQ/exec";
const BUKU_URL = "senarai_pembelian_buku.pdf";

let selectedTing = null;

/* ================= NAV ================= */
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
function goHome(){
  selectedTing=null;
  document.getElementById("ic").value="";
  show("home");
}
function startSemak(t){
  selectedTing=t;
  document.getElementById("badgeTing").innerText="Tingkatan "+t;
  show("input");
}
function openBuku(){
  window.open(BUKU_URL,"_blank");
}

/* ================= UTIL ================= */
function cleanIC(v){return (v||"").replace(/\D/g,"")}
function field(l,v){
  return `<div class="field">
    <div class="label">${l}</div>
    <div class="value">${v||"-"}</div>
  </div>`;
}
function showError(msg){
  document.getElementById("errorMsg").innerText=msg;
  show("error");
}

/* ===== FIX JANTINA & BANGSA ===== */
function getJantina(d){
  return d.jantina || d.JANTINA || d.Gender || "-";
}
function getBangsa(d){
  return d.bangsa || d.BANGSA || d.Ras || "-";
}

/* ================= SUBMIT ================= */
async function submitCheck(){
  const ic = cleanIC(document.getElementById("ic").value);

  if(ic.length!==12){
    showError("No IC mesti 12 digit.");
    return;
  }
  if(!selectedTing){
    showError("Sila pilih Tingkatan.");
    return;
  }

  show("loading");

  try{
    const url = API_URL+"?ting="+selectedTing+"&mode=kelas&ic="+ic;
    const res = await fetch(url);
    if(!res.ok) throw new Error("HTTP "+res.status);
    const data = await res.json();

    if(!data || data.ok===false){
      showError("Rekod tidak dijumpai.");
      return;
    }

    showResult(data);
  }catch(e){
    console.error(e);
    showError("Sistem tidak dapat dihubungi.");
  }
}

/* ================= RESULT ================= */
function showResult(data){
  let html="";
  html+=field("Nama Pelajar",data.nama);
  html+=field("Jantina",getJantina(data));
  html+=field("Bangsa",getBangsa(data));
  html+=field("KDK",data.kdk);
  html+=f
