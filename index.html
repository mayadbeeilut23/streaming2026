<!doctype html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Semakan Kedudukan Kelas</title>

<style>
:root{
  --primary:#ffc4d6;
  --secondary:#ffe4d4;
  --bg1:#fff7cc;
  --bg2:#fff1b8;
  --text:#2d2d2d;
  --muted:#666;
  --card:#ffffff;
  --border:#eee;
  --dangerBg:#ffe5e5;
  --dangerText:#b30000;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:24px;
  color:var(--text);
}
.container{max-width:520px;width:100%}

.screen{display:none}
.screen.active{display:block}

.header{ text-align:center; margin-bottom:18px; }

.badge{
  display:inline-block;
  padding:8px 12px;
  border-radius:999px;
  font-weight:900;
  font-size:.85rem;
  background: rgba(255,196,214,.35);
  margin: 0 auto 10px;
}

.logo{
  background:#fff;width:120px;height:120px;margin:0 auto 16px;
  border-radius:22px;display:flex;align-items:center;justify-content:center;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}
.logo img{width:90px;height:auto;display:block}

.title{text-align:center;font-weight:800;margin:0}
.subtitle{text-align:center;color:var(--muted);margin:8px 0 0}

.grid{display:flex;flex-direction:column;gap:12px; margin-top:18px;}

.pill{
  width:100%;
  border:none;
  border-radius:999px;
  padding:16px 18px;
  font-weight:800;
  cursor:pointer;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:var(--text);
  box-shadow: 0 8px 20px rgba(255,196,214,.35);
}
.pill.secondary{
  background:#eee;
  box-shadow: 0 8px 18px rgba(0,0,0,.08);
}

.input-wrap{
  background:#fff;
  border-radius:22px;
  padding:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  overflow:hidden;
}

.input{
  width:100%;
  padding:14px 16px;
  border-radius:999px;
  border:2px solid var(--primary);
  font-size:1rem;
  outline:none;
}
.input:focus{ border-color:#ff9bb5; }

.row{display:flex; gap:12px; margin-top:14px;}
.row .pill{flex:1; padding:14px 14px; text-transform:none;}

.card{
  background:#fff;
  border-radius:22px;
  padding:18px;
  margin-top:10px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.field{padding:10px 0;border-bottom:1px solid var(--border)}
.field:last-child{border-bottom:none}
.label{font-size:.75rem;font-weight:900;color:#888;text-transform:uppercase;letter-spacing:.3px}
.value{font-size:1.05rem;font-weight:800}

/* âœ… LOADING COMEL */
.loading{
  background:#fff;
  border-radius:22px;
  padding:26px 18px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
  text-align:center;
}
.spinner{
  width:56px;height:56px;margin:0 auto 12px;
  border-radius:50%;
  border: 4px solid rgba(255,196,214,.55);
  border-top: 4px solid #ff9bb5;
  animation: spin 1s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}
.tiny{margin-top:8px;font-size:.9rem;color:#777}

/* optional: error */
.errorBox{
  background:var(--dangerBg);
  border-radius:22px;
  padding:18px;
  text-align:center;
  font-weight:900;
  color:var(--dangerText);
}
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<section id="home" class="screen active">
  <div class="logo"><img src="logopaloh.png" alt="Logo SMK Paloh"></div>
  <h1 class="title">Sistem Semakan Kedudukan Kelas</h1>
  <p class="subtitle">Pilih Tingkatan â†’ Masuk No IC â†’ Semak â†’ Papar Result</p>

  <div class="grid">
    <button class="pill" type="button" onclick="start(2)">Tingkatan 2</button>
    <button class="pill" type="button" onclick="start(3)">Tingkatan 3</button>
  </div>
</section>

<!-- INPUT -->
<section id="input" class="screen">
  <div class="header">
    <div class="badge" id="badgeTing">Tingkatan</div>
    <h2 class="title" style="font-size:1.25rem;">Masukkan No IC</h2>
    <p class="subtitle">Contoh: 051234567890 (12 digit)</p>
  </div>

  <div class="input-wrap">
    <input id="ic" class="input" inputmode="numeric" maxlength="14" placeholder="No IC 12 digit (tanpa -)">
    <div class="row">
      <button class="pill" type="button" onclick="semak()">Semak</button>
      <button class="pill secondary" type="button" onclick="goHome()">Kembali</button>
    </div>
  </div>
</section>

<!-- âœ… LOADING -->
<section id="loading" class="screen">
  <div class="loading">
    <div class="spinner"></div>
    <div style="font-weight:900; font-size:1.05rem;">Menyemak maklumat...</div>
    <div class="tiny">Sekejap ya ðŸ˜„</div>
  </div>
</section>

<!-- RESULT -->
<section id="result" class="screen">
  <div class="header">
    <div class="badge" id="badgeResult">Keputusan</div>
    <h2 class="title" style="font-size:1.25rem;">Papar Maklumat</h2>
    <p class="subtitle">Berjaya! Maklumat dijumpai.</p>
  </div>

  <div id="resultBox" class="card"></div>

  <div class="row" style="margin-top:14px;">
    <button class="pill secondary" type="button" onclick="goHome()">Kembali (Main Page)</button>
  </div>
</section>

<!-- ERROR (optional, kalau nak elak alert) -->
<section id="error" class="screen">
  <div class="errorBox" id="errorMsg">Ada masalah.</div>
  <div class="row" style="margin-top:14px;">
    <button class="pill secondary" type="button" onclick="goHome()">Kembali (Main Page)</button>
  </div>
</section>

</div>

<script>
const apiUrl="https://script.google.com/macros/s/AKfycbxJzukkZf4P8Y8cA3WrSVp6ISkvXhMgsqzjVElhfW4_SBPafEt0_lsnkCM17_NF1SsO/exec";
let tingkatan=null;

function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  const el=document.getElementById(id);
  if(el) el.classList.add("active");
}

function goHome(){
  tingkatan=null;
  const ic=document.getElementById("ic");
  if(ic) ic.value="";
  show("home");
}

function start(t){
  tingkatan=t;
  document.getElementById("badgeTing").innerText="Tingkatan "+t;
  document.getElementById("ic").value="";
  show("input");
  setTimeout(()=>document.getElementById("ic").focus(),80);
}

function cleanIC(v){ return (v||"").replace(/\D/g,""); }

function esc(s){
  return String(s ?? "-")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function showError(msg){
  // kalau you suka alert, tukar ke alert(msg)
  document.getElementById("errorMsg").textContent = msg || "Ada masalah.";
  show("error");
}

async function semak(){
  if(!tingkatan){
    showError("Sila pilih Tingkatan dahulu.");
    return;
  }

  const icEl=document.getElementById("ic");
  const ic=cleanIC(icEl.value);
  icEl.value=ic;

  if(ic.length!==12){
    showError("No IC mesti 12 digit (tanpa simbol -).");
    return;
  }

  // âœ… show loading comel
  show("loading");

  const url=`${apiUrl}?ting=${encodeURIComponent(tingkatan)}&mode=kelas&ic=${encodeURIComponent(ic)}`;

  try{
    const res=await fetch(url,{method:"GET"});
    const data=await res.json();

    if(!data || data.ok===false){
      showError(data?.message || "Rekod tidak dijumpai.");
      return;
    }

    document.getElementById("badgeResult").innerText = `Tingkatan ${tingkatan} â€¢ Keputusan`;

    document.getElementById("resultBox").innerHTML=`
      <div class="field"><div class="label">Nama</div><div class="value">${esc(data.nama)}</div></div>
      <div class="field"><div class="label">Jantina</div><div class="value">${esc(data.jantina)}</div></div>
      <div class="field"><div class="label">Bangsa</div><div class="value">${esc(data.bangsa)}</div></div>
      <div class="field"><div class="label">KDK</div><div class="value">${esc(data.kdk)}</div></div>
      <div class="field"><div class="label">KDT</div><div class="value">${esc(data.kdt)}</div></div>
      <div class="field"><div class="label">Kelas 2025</div><div class="value">${esc(data.kelas_2025)}</div></div>
      <div class="field"><div class="label">Kelas 2026</div><div class="value">${esc(data.kelas_2026)}</div></div>
      <div class="field"><div class="label">Guru Tingkatan 2026</div><div class="value">${esc(data.guru_tingkatan_2026)}</div></div>
    `;
    show("result");

  }catch(e){
    console.error(e);
    showError("Tak dapat connect ke server / Apps Script. Cuba lagi.");
  }
}
</script>

</body>
</html>
