<!doctype html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistem Semakan Kedudukan Kelas</title>

<style>
:root{
  --primary:#ffc4d6;
  --secondary:#ffe4d4;
  --bg1:#fff7cc;
  --bg2:#fff1b8;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:"Segoe UI",Tahoma,Verdana,sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2));
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  padding:24px;
}

.container{width:100%;max-width:520px}

.screen{display:none}
.screen.active{display:block}

.header{text-align:center;margin-bottom:20px}

.logo{
  width:120px;height:120px;
  margin:0 auto 16px;
  background:#fff;
  border-radius:22px;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.logo img{
  width:90px;
  height:auto;
}

.btn{
  width:100%;
  padding:16px;
  border:none;
  border-radius:999px;
  font-weight:800;
  text-transform:uppercase;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  margin-bottom:12px;
  cursor:pointer;
}
.btn.secondary{background:#eee}

.card{
  background:#fff;
  padding:20px;
  border-radius:22px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

input{
  width:100%;
  padding:14px;
  border-radius:999px;
  border:2px solid var(--primary);
}

.result-card{
  background:#fff;
  padding:18px;
  border-radius:22px;
  box-shadow:0 10px 30px rgba(0,0,0,.08);
}

.field{border-bottom:1px solid #eee;padding:10px 0}
.field:last-child{border-bottom:none}
.label{font-size:.75rem;font-weight:900;color:#888}
.value{font-size:1.05rem;font-weight:800}
</style>
</head>

<body>
<div class="container">

<!-- HOME -->
<section id="home" class="screen active">
  <div class="header">
    <div class="logo">
      <!-- ðŸ”¥ PATH LOGO FIX -->
      <img src="logopaloh.png" alt="Logo SMK Paloh">
    </div>
    <h1>Sistem Semakan Kedudukan Kelas</h1>
    <p>Pilih Tingkatan â†’ Masuk No IC â†’ Papar Keputusan</p>
  </div>

  <button class="btn" onclick="startSemak(2)">Tingkatan 2</button>
  <button class="btn" onclick="startSemak(3)">Tingkatan 3</button>
</section>

<!-- INPUT -->
<section id="input" class="screen">
  <h2 id="badgeTing"></h2>
  <div class="card">
    <input id="ic" placeholder="No IC 12 digit">
    <button class="btn" onclick="submitCheck()">Semak</button>
    <button class="btn secondary" onclick="goHome()">Kembali</button>
  </div>
</section>

<!-- RESULT -->
<section id="result" class="screen">
  <h2>Keputusan</h2>
  <div id="resultBox" class="result-card"></div>
  <button class="btn secondary" onclick="goHome()">Main Page</button>
</section>

</div>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbw-Ptinh6OwlWtPhU7_BACIZi1AXKJ6ibOsVj_tHA80zHWMFH0b1CygYfhhABt2cbT4vQ/exec";
const SENARAI_BUKU_URL = "panduan_kelas_t2.pdf";

let selectedTing = null;

/* ===== SCREEN CONTROL ===== */
function go(id){
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function goHome(){
  selectedTing = null;
  document.getElementById("ic").value = "";
  go("home");
}

/* ===== START SEMAK ===== */
function startSemak(t){
  selectedTing = t;
  document.getElementById("badgeTing").innerText = "Tingkatan " + t;
  document.getElementById("ic").value = "";
  go("input");
}

/* ===== INPUT CLEAN ===== */
function cleanIC(v){
  return (v || "").replace(/\D/g,"");
}

/* ===== SUBMIT ===== */
async function submitCheck(){
  const icInput = document.getElementById("ic");
  const ic = cleanIC(icInput.value);
  icInput.value = ic;

  if(!selectedTing){
    showError("Sila pilih Tingkatan.");
    return;
  }

  if(ic.length !== 12){
    showError("No IC mesti 12 digit.");
    return;
  }

  go("loading");

  try{
    const url = apiUrl + "?ting=" + selectedTing + "&mode=kelas&ic=" + ic;
    const res = await fetch(url);
    const data = await res.json();

    if(!data || data.ok === false){
      showError(data?.message || "Rekod tidak dijumpai.");
      return;
    }

    showResult(data);

  }catch(err){
    showError("Ralat sambungan server.");
    console.error(err);
  }
}

/* ===== RESULT ===== */
function showResult(data){
  const box = document.getElementById("resultBox");
  box.innerHTML = `
    <div class="field"><div class="label">Nama Pelajar</div><div class="value">${data.nama || "-"}</div></div>
    <div class="field"><div class="label">Jantina</div><div class="value">${data.jantina || "-"}</div></div>
    <div class="field"><div class="label">Bangsa</div><div class="value">${data.bangsa || "-"}</div></div>
    <div class="field"><div class="label">KDK</div><div class="value">${data.kdk || "-"}</div></div>
    <div class="field"><div class="label">KDT</div><div class="value">${data.kdt || "-"}</div></div>
    <div class="field"><div class="label">Kelas 2025</div><div class="value">${data.kelas_2025 || "-"}</div></div>
    <div class="field"><div class="label">Kelas 2026</div><div class="value">${data.kelas_2026 || "-"}</div></div>
    <div class="field"><div class="label">Guru Tingkatan 2026</div><div class="value">${data.guru_tingkatan_2026 || "-"}</div></div>
  `;
  go("result");
}

/* ===== ERROR ===== */
function showError(msg){
  document.getElementById("errorMsg").innerText = msg;
  go("error");
}

/* ===== BUKU ===== */
function openSenaraiBuku(){
  window.open(SENARAI_BUKU_URL,"_blank");
}
</script>

